---
title: Do blurbs predict whether films will pass the Bechdel test?
author: Luke McGuinness
date: '2021-04-12'
slug: do-blurbs-predict-whether-films-will-pass-the-bechdel-test
categories:
  - tidymodels
  - prediction
  - machine learning
  - R
  - side-project
tags: []
excerpt: Put excerpt here
math: no
meta: yes
draft: true
---



<div id="install-relevant-pacakges" class="section level2">
<h2>Install relevant pacakges</h2>
</div>
<div id="load-the-data" class="section level2">
<h2>Load the data</h2>
<pre class="r"><code>library(tidyverse)
library(tidytext)

tuesdata &lt;- tidytuesdayR::tt_load(&#39;2021-03-09&#39;)

movies &lt;- tuesdata$movies %&gt;%
  select(title, plot, binary) %&gt;%
  filter(!is.na(plot) &amp; !is.na(binary)) %&gt;%
  mutate(text = plot) %&gt;%
  select(-plot)
  
movies %&gt;%
  unnest_tokens(word, text) %&gt;%
  count(title, name = &quot;total_words&quot;) %&gt;%
  ggplot(aes(total_words)) +
  geom_histogram(fill = &quot;midnightblue&quot;, alpha = 0.8)</code></pre>
<div id="build-a-model" class="section level3">
<h3>Build a model</h3>
<pre class="r"><code>library(tidymodels)

set.seed(42)
review_split &lt;- initial_split(movies, strata = binary)
review_train &lt;- training(review_split)
review_test &lt;- testing(review_split)</code></pre>
<pre class="r"><code>library(textrecipes)
library(stopwords)

review_rec &lt;- recipe(binary ~ text, data = review_train) %&gt;%
  step_tokenize(text) %&gt;%
  step_stopwords(text) %&gt;%
  step_tokenfilter(text, max_tokens = 500) %&gt;%
  step_tfidf(text) %&gt;%
  step_normalize(all_predictors())

review_prep &lt;- prep(review_rec)

review_prep</code></pre>
</div>
<div id="section" class="section level3">
<h3></h3>
<pre class="r"><code>lasso_spec &lt;- logistic_reg(penalty = tune(), mixture = 1) %&gt;%
  set_engine(&quot;glmnet&quot;)

lasso_wf &lt;- workflow() %&gt;%
  add_recipe(review_rec) %&gt;%
  add_model(lasso_spec)

lasso_wf</code></pre>
<p><label for="tufte-mn-" class="margin-toggle">âŠ•</label><input type="checkbox" id="tufte-mn-" class="margin-toggle"><span class="marginnote">You may need the development version of <code>recipes</code> for this to work, as per <a href="https://github.com/tidymodels/tune/issues/192">this issue</a></span></p>
<pre class="r"><code>lambda_grid &lt;- grid_regular(penalty(), levels = 40)

set.seed(42)
review_folds &lt;- bootstraps(review_train, strata = binary)
review_folds

doParallel::registerDoParallel()

set.seed(2020)
lasso_grid &lt;- tune_grid(
  lasso_wf,
  resamples = review_folds,
  grid = lambda_grid,
  metrics = metric_set(roc_auc, ppv, npv)
)

lasso_grid %&gt;%
  collect_metrics()</code></pre>
</div>
</div>
